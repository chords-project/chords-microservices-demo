/*
 * This source file was generated by the Gradle 'init' task
 */
package dev.chords.microservices.benchmark;

import java.util.Scanner;

import choral.reactive.tracing.JaegerConfiguration;

public class Benchmark {

    public static void main(String[] args) throws Exception {

        final String SERVICE_A = "localhost:8201";
        final String SERVICE_B = "localhost:8202";

        final String JAEGER_ENDPOINT = "http://localhost:4317";

        GrpcServer grpcServer = new GrpcServer();
        grpcServer.start(5430);

        ServiceA serviceA = new ServiceA(JaegerConfiguration.initTelemetry(JAEGER_ENDPOINT, "ServiceA"), SERVICE_B);
        ServiceB serviceB = new ServiceB(JaegerConfiguration.initTelemetry(JAEGER_ENDPOINT, "ServiceB"), SERVICE_A);

        serviceA.listen(SERVICE_A);
        serviceB.listen(SERVICE_B);

        serviceA.startPingPong();
        serviceA.startGreeting();

        Scanner input = new Scanner(System.in);
        System.out.print("Press Enter to perform benchmark...");
        input.nextLine();
        input.close();

        // serviceA.startGreeting();

        for (int i = 0; i < 5; i++) {
            serviceA.startPingPong();
            Thread.sleep(50);
        }

        for (int i = 0; i < 5; i++) {
            serviceA.startGreeting();
            Thread.sleep(50);
        }

        serviceA.close();
        serviceB.close();
        grpcServer.stop();
    }
}
